(this.webpackJsonpstreamtest=this.webpackJsonpstreamtest||[]).push([[0],[,,function(t,e,n){t.exports={container:"Main_container__1ZgYJ",top:"Main_top__39ZCP",bottom:"Main_bottom__7DZSF"}},,,,function(t,e,n){t.exports={container:"FirstPlayer_container__1EsvK"}},,,,,function(t,e,n){},function(t,e,n){},,function(t,e,n){"use strict";n.r(e);var i=n(1),a=n.n(i),s=n(5),o=n.n(s),r=(n(11),n(12),n(4)),u=n(2),c=n.n(u),h=n(6),l=n.n(h);function p(t){this.init(t)}p.prototype.init=function(t){this.option=Object.assign({},{encoding:"16bitInt",channels:1,sampleRate:8e3,flushingTime:1e3},t),this.samples=new Float32Array,this.flush=this.flush.bind(this),this.interval=setInterval(this.flush,this.option.flushingTime),this.maxValue=this.getMaxValue(),this.typedArray=this.getTypedArray(),this.createContext()},p.prototype.getMaxValue=function(){var t={"8bitInt":128,"16bitInt":32768,"32bitInt":2147483648,"32bitFloat":1};return t[this.option.encoding]?t[this.option.encoding]:t["16bitInt"]},p.prototype.getTypedArray=function(){var t={"8bitInt":Int8Array,"16bitInt":Int16Array,"32bitInt":Int32Array,"32bitFloat":Float32Array};return t[this.option.encoding]?t[this.option.encoding]:t["16bitInt"]},p.prototype.createContext=function(){var t=this;this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.audioCtx.resume(),this.audioCtx.onstatechange=function(){return console.log(t.audioCtx.state)},this.gainNode=this.audioCtx.createGain(),this.gainNode.gain.value=1,this.gainNode.connect(this.audioCtx.destination),this.startTime=this.audioCtx.currentTime},p.prototype.isTypedArray=function(t){return t.byteLength&&t.buffer&&t.buffer.constructor==ArrayBuffer},p.prototype.feed=function(t){if(this.isTypedArray(t)){t=this.getFormatedValue(t);var e=new Float32Array(this.samples.length+t.length);e.set(this.samples,0),e.set(t,this.samples.length),this.samples=e}},p.prototype.getFormatedValue=function(t){t=new this.typedArray(t.buffer);var e,n=new Float32Array(t.length);for(e=0;e<t.length;e++)n[e]=t[e]/this.maxValue;return n},p.prototype.volume=function(t){this.gainNode.gain.value=t},p.prototype.destroy=function(){this.interval&&clearInterval(this.interval),this.samples=null,this.audioCtx.close(),this.audioCtx=null},p.prototype.flush=function(){if(this.samples.length){var t,e,n,i,a,s=this.audioCtx.createBufferSource(),o=this.samples.length/this.option.channels,r=this.audioCtx.createBuffer(this.option.channels,o,this.option.sampleRate);for(e=0;e<this.option.channels;e++)for(t=r.getChannelData(e),n=e,a=50,i=0;i<o;i++)t[i]=this.samples[n],i<50&&(t[i]=t[i]*i/50),i>=o-51&&(t[i]=t[i]*a--/50),n+=this.option.channels;this.startTime<this.audioCtx.currentTime&&(this.startTime=this.audioCtx.currentTime),console.log("start vs current "+this.startTime+" vs "+this.audioCtx.currentTime+" duration: "+r.duration),s.buffer=r,s.connect(this.gainNode),s.start(this.startTime),this.startTime+=r.duration,this.samples=new Float32Array}};var d=n(0);var f=function(t){var e=t.url;return Object(i.useEffect)((function(){var t="ws://".concat(e),n=new p({encoding:"16bitInt",channels:2,sampleRate:8e3,flushingTime:2e3}),i=new WebSocket(t);i.binaryType="arraybuffer",i.addEventListener("message",(function(t){var e=new Uint8Array(t.data);n.feed(e)}))}),[e]),Object(d.jsx)("div",{className:l.a.container})};var m=function(){var t=Object(i.useState)(""),e=Object(r.a)(t,2),n=e[0],a=e[1],s=Object(i.useState)("localhost:8080"),o=Object(r.a)(s,2),u=o[0],h=o[1];return Object(i.useEffect)((function(){}),[n]),Object(d.jsxs)("div",{className:c.a.container,children:[Object(d.jsx)("div",{className:c.a.top,children:Object(d.jsx)("input",{value:n,onChange:function(t){return a(t.target.value)},onBlur:function(){return h(n)}})}),Object(d.jsx)("div",{className:c.a.bottom,children:Object(d.jsx)(f,{url:u})})]})};var b=function(){return Object(d.jsx)(m,{})};o.a.render(Object(d.jsx)(a.a.StrictMode,{children:Object(d.jsx)(b,{})}),document.getElementById("root"))}],[[14,1,2]]]);
//# sourceMappingURL=main.0ae9e39b.chunk.js.map